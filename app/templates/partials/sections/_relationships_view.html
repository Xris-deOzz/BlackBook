{# Relationships Section - View Mode #}
<div class="space-y-4">
    {# My Relationship (collapsible) #}
    <details open class="group">
        <summary class="cursor-pointer flex items-center gap-2 text-xs font-semibold text-blackbook-500 uppercase tracking-wide hover:text-blackbook-700">
            <svg class="w-3 h-3 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            My Relationship
        </summary>
        <div class="mt-2 p-3 bg-blackbook-50 rounded-lg">
            {% if person.my_relationship_type %}
            <div class="flex items-center gap-2 flex-wrap">
                <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 font-medium">
                    {{ person.my_relationship_type.name }}
                </span>
                {% if person.my_relationship_notes %}
                <span class="text-sm text-blackbook-600">{{ person.my_relationship_notes }}</span>
                {% endif %}
            </div>
            {% else %}
            <p class="text-sm text-blackbook-400 italic">Not set - click Edit to define how you know this person</p>
            {% endif %}
        </div>
    </details>

    {# Their Connections (collapsible) #}
    <details open class="group">
        <summary class="cursor-pointer flex items-center gap-2 text-xs font-semibold text-blackbook-500 uppercase tracking-wide hover:text-blackbook-700">
            <svg class="w-3 h-3 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            Their Connections
            {% if person.relationships_from %}
            <span class="text-blackbook-400 font-normal">({{ person.relationships_from|length }})</span>
            {% endif %}
        </summary>

        {% if person.relationships_from %}
        <div class="mt-2 space-y-2">
            {# Sort relationships by display_order (family first) then by name #}
            {% set sorted_relationships = person.relationships_from|sort(attribute='relationship_type.display_order,related_person.full_name') %}

            {% for rel in sorted_relationships %}
            <div class="p-3 bg-blackbook-50 rounded-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        {# Related person avatar #}
                        {% if rel.related_person.profile_picture %}
                        <img src="{{ rel.related_person.profile_picture }}"
                             alt="{{ rel.related_person.full_name }}"
                             class="w-10 h-10 rounded-full object-cover">
                        {% else %}
                        <div class="w-10 h-10 rounded-full bg-blackbook-200 flex items-center justify-center">
                            <span class="text-sm font-medium text-blackbook-600">
                                {{ rel.related_person.full_name[0]|upper }}
                            </span>
                        </div>
                        {% endif %}

                        <div>
                            <a href="/people/{{ rel.related_person.id }}" class="font-medium text-blackbook-900 hover:text-blue-600">
                                {{ rel.related_person.full_name }}
                            </a>
                            {% if rel.related_person.title %}
                            <div class="text-xs text-blackbook-500">{{ rel.related_person.title }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="flex items-center gap-2 flex-wrap justify-end">
                        {% if rel.relationship_type %}
                        {# Color-code by category #}
                        {% set badge_class = {
                            'family': 'bg-pink-100 text-pink-700',
                            'education': 'bg-yellow-100 text-yellow-700',
                            'professional': 'bg-green-100 text-green-700',
                            'introduction': 'bg-purple-100 text-purple-700',
                            'personal': 'bg-blue-100 text-blue-700'
                        }.get(rel.relationship_type.category, 'bg-gray-100 text-gray-600') %}
                        <span class="px-2 py-1 text-xs rounded-full {{ badge_class }}">
                            {{ rel.relationship_type.name }}
                        </span>
                        {% endif %}
                        {% if rel.context_organization %}
                        <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600">
                            @ {{ rel.context_organization.name }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% if rel.context_text %}
                <div class="mt-2 ml-13 text-sm text-blackbook-500 italic border-l-2 border-blackbook-200 pl-3">
                    {{ rel.context_text }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="mt-2 p-3 bg-blackbook-50 rounded-lg">
            <p class="text-sm text-blackbook-400 italic">No connections recorded</p>
        </div>
        {% endif %}
    </details>
</div>
