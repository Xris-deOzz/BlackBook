{% extends "base.html" %}

{% block title %}{{ contact.name or contact.email }} - Pending Contact{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mb-6">
        <a href="/pending-contacts" class="text-blue-600 hover:text-blue-800 text-sm">
            &larr; Back to Pending Contacts
        </a>
    </div>

    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
            <div>
                <h3 class="text-lg leading-6 font-medium text-blackbook-900">
                    {{ contact.name or '(No name)' }}
                </h3>
                <p class="mt-1 max-w-2xl text-sm text-blackbook-500">
                    {{ contact.email }}
                </p>
            </div>
            <div>
                {% if contact.status.value == 'pending' %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                    Pending Review
                </span>
                {% elif contact.status.value == 'created' %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                    Person Created
                </span>
                {% else %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blackbook-100 text-blackbook-800">
                    Ignored
                </span>
                {% endif %}
            </div>
        </div>
        <div class="border-t border-blackbook-200">
            <dl>
                <div class="bg-blackbook-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-blackbook-500">Email</dt>
                    <dd class="mt-1 text-sm text-blackbook-900 sm:mt-0 sm:col-span-2">{{ contact.email }}</dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-blackbook-500">Name</dt>
                    <dd class="mt-1 text-sm text-blackbook-900 sm:mt-0 sm:col-span-2">{{ contact.name or 'Not provided' }}</dd>
                </div>
                <div class="bg-blackbook-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-blackbook-500">Occurrence Count</dt>
                    <dd class="mt-1 text-sm text-blackbook-900 sm:mt-0 sm:col-span-2">
                        {{ contact.occurrence_count }} meeting{% if contact.occurrence_count != 1 %}s{% endif %}
                    </dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-blackbook-500">First Seen</dt>
                    <dd class="mt-1 text-sm text-blackbook-900 sm:mt-0 sm:col-span-2">
                        {{ contact.first_seen_at.strftime('%B %d, %Y at %I:%M %p') if contact.first_seen_at else 'Unknown' }}
                    </dd>
                </div>
                {% if contact.created_person_id %}
                <div class="bg-blackbook-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-blackbook-500">Linked Person</dt>
                    <dd class="mt-1 text-sm text-blackbook-900 sm:mt-0 sm:col-span-2">
                        <a href="/people/{{ contact.created_person_id }}" class="text-blue-600 hover:text-blue-800">
                            View Person &rarr;
                        </a>
                    </dd>
                </div>
                {% endif %}
            </dl>
        </div>
    </div>

    {% if contact.status.value == 'pending' %}
    <!-- Actions Section -->
    <div class="mt-8 bg-white shadow sm:rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-blackbook-900">Actions</h3>
            <div class="mt-5 space-y-4">
                <!-- Create Person -->
                <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-blackbook-50">
                    <div>
                        <h4 class="text-sm font-medium text-blackbook-900">Create New Person</h4>
                        <p class="text-sm text-blackbook-500">Create a new person record from this contact</p>
                    </div>
                    <button hx-post="/pending-contacts/{{ contact.id }}/create"
                            hx-swap="none"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                        Create Person
                    </button>
                </div>

                <!-- Ignore -->
                <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-blackbook-50">
                    <div>
                        <h4 class="text-sm font-medium text-blackbook-900">Ignore Contact</h4>
                        <p class="text-sm text-blackbook-500">Mark as ignored (won't appear in pending list)</p>
                    </div>
                    <button hx-post="/pending-contacts/{{ contact.id }}/ignore"
                            hx-swap="none"
                            class="inline-flex items-center px-4 py-2 border border-blackbook-300 text-sm font-medium rounded-md text-blackbook-700 bg-white hover:bg-blackbook-50">
                        Ignore
                    </button>
                </div>

                <!-- Delete -->
                <div class="flex items-center justify-between p-4 border border-red-200 rounded-lg hover:bg-red-50">
                    <div>
                        <h4 class="text-sm font-medium text-red-900">Delete Contact</h4>
                        <p class="text-sm text-red-500">Permanently delete this pending contact</p>
                    </div>
                    <button hx-delete="/pending-contacts/{{ contact.id }}"
                            hx-swap="none"
                            hx-confirm="Are you sure you want to delete this contact?"
                            class="inline-flex items-center px-4 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% if potential_matches %}
    <!-- Potential Matches -->
    <div class="mt-8 bg-white shadow sm:rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-blackbook-900">Potential Matches</h3>
            <p class="mt-1 text-sm text-blackbook-500">
                Existing people with similar email domains
            </p>
            <div class="mt-5 space-y-3">
                {% for person in potential_matches %}
                <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-blackbook-50">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10 bg-blackbook-200 rounded-full flex items-center justify-center text-blackbook-600 font-medium">
                            {{ person.full_name[0]|upper if person.full_name else '?' }}
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-blackbook-900">{{ person.full_name }}</div>
                            <div class="text-sm text-blackbook-500">{{ person.email }}</div>
                        </div>
                    </div>
                    <button hx-post="/pending-contacts/{{ contact.id }}/merge/{{ person.id }}"
                            hx-swap="none"
                            class="inline-flex items-center px-3 py-1.5 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-white hover:bg-blue-50">
                        Merge
                    </button>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    {% endif %}
</div>
{% endblock %}
