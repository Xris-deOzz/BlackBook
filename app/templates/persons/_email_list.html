{% if threads %}
<div class="space-y-3">
    {% for thread in threads %}
    <div class="border-l-2 border-blue-200 pl-4 py-2 hover:bg-blue-50 -ml-4 -mr-2 px-4 rounded-r transition-colors group">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-2 flex-wrap">
                <span class="text-sm font-medium text-blackbook-900 line-clamp-1">
                    {{ thread.subject or '(No subject)' }}
                </span>
                <span class="text-xs text-blackbook-500">
                    {{ thread.message_count }} message{% if thread.message_count != 1 %}s{% endif %}
                </span>
            </div>
            {% if thread.last_message_date %}
            <span class="text-xs text-blackbook-400 whitespace-nowrap ml-2">
                {{ thread.last_message_date[:10] }}
            </span>
            {% endif %}
        </div>
        <p class="text-sm text-blackbook-600 mt-1 line-clamp-2">{{ thread.snippet }}</p>
        <div class="flex items-center gap-3 mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
            <button
                hx-post="/emails/thread/{{ thread.account_id }}/{{ thread.thread_id }}/log?person_id={{ person_id }}"
                hx-target="#email-log-result"
                hx-swap="innerHTML"
                class="text-xs text-blue-600 hover:text-blue-800 font-medium">
                Log as Interaction
            </button>
            <a href="{{ thread.gmail_link }}" target="_blank"
               class="text-xs text-blackbook-500 hover:text-blackbook-700">
                View in Gmail →
            </a>
            <span class="text-xs text-blackbook-400">
                via {{ thread.account_email }}
            </span>
        </div>
    </div>
    {% endfor %}
</div>

{% if from_cache %}
<p class="text-xs text-blackbook-400 mt-4 text-center">
    Cached results •
    <button hx-get="/emails/person/{{ person_id }}/refresh"
            hx-target="#email-list"
            class="text-blue-600 hover:underline">Refresh</button>
</p>
{% endif %}

<div id="email-log-result" class="mt-2"></div>

{% else %}
<div class="text-center py-8">
    <svg class="mx-auto h-12 w-12 text-blackbook-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
    </svg>
    <p class="mt-2 text-sm text-blackbook-500">No email history found</p>
    {% if not has_accounts %}
    <p class="text-xs text-blackbook-400 mt-1">
        <a href="/settings" class="text-blue-600 hover:underline">Connect a Google account</a> to see email history
    </p>
    {% endif %}
</div>
{% endif %}
