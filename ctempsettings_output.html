<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/icon-16.png">

    <!-- PWA Meta Tags -->
    <meta name="description" content="Personal CRM for managing professional relationships">
    <meta name="theme-color" content="#f97316">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BlackBook">
    <link rel="manifest" href="/static/icons/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">

    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Tom Select - searchable dropdowns -->
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>

    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'blackbook': {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>

    <!-- Apply theme before page renders to prevent flash -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'system';
            if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Dark Mode Global Overrides -->
    <style>
        /* Apply dark mode to common Tailwind classes when html has .dark */
        .dark .bg-white { background-color: #1e293b !important; } /* blackbook-800 */
        .dark .bg-blackbook-50 { background-color: #0f172a !important; } /* blackbook-900 */
        .dark .bg-blackbook-100 { background-color: #334155 !important; } /* blackbook-700 */
        .dark .text-blackbook-900 { color: #f1f5f9 !important; } /* blackbook-100 */
        .dark .text-blackbook-800 { color: #e2e8f0 !important; } /* blackbook-200 */
        .dark .text-blackbook-700 { color: #cbd5e1 !important; } /* blackbook-300 */
        .dark .text-blackbook-600 { color: #94a3b8 !important; } /* blackbook-400 */
        .dark .text-blackbook-500 { color: #94a3b8 !important; } /* blackbook-400 */
        .dark .border-blackbook-200 { border-color: #475569 !important; } /* blackbook-600 */
        .dark .border-blackbook-300 { border-color: #475569 !important; } /* blackbook-600 */
        .dark .divide-blackbook-200 > :not([hidden]) ~ :not([hidden]) { border-color: #475569 !important; }
        .dark .hover\:bg-blackbook-50:hover { background-color: #334155 !important; } /* blackbook-700 */
        .dark input, .dark select, .dark textarea {
            background-color: #334155 !important;
            border-color: #475569 !important;
            color: #f1f5f9 !important;
        }
        .dark input::placeholder, .dark textarea::placeholder {
            color: #94a3b8 !important;
        }
        .dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.2) !important; }
        .dark .shadow { box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px -1px rgba(0, 0, 0, 0.2) !important; }
        .dark a:not(.bg-blue-600):not(.bg-blackbook-900) { color: #60a5fa; }
        .dark th { background-color: #1e293b !important; }
        .dark tbody tr:hover { background-color: #334155 !important; }
        /* Tom Select dark mode */
        .dark .ts-wrapper .ts-control { background-color: #334155 !important; border-color: #475569 !important; color: #f1f5f9 !important; }
        .dark .ts-wrapper .ts-control input { color: #f1f5f9 !important; }
        .dark .ts-dropdown { background-color: #334155 !important; border-color: #475569 !important; }
        .dark .ts-dropdown .option { color: #f1f5f9 !important; }
        .dark .ts-dropdown .option:hover, .dark .ts-dropdown .option.active { background-color: #475569 !important; }
        .dark .ts-wrapper.focus .ts-control { border-color: #60a5fa !important; box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.3) !important; }
    </style>

    <!-- Collapsible Sections Styles -->
    <style>
        /* Hide default marker in all browsers */
        summary::-webkit-details-marker { display: none; }
        summary::marker { display: none; }
        summary { list-style: none; }
    </style>

    <!-- Column Resizing Styles -->
    <style>
        /* Resizable table columns */
        .resizable-table {
            table-layout: fixed;
            width: 100%;
        }
        .resizable-table th {
            position: relative;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .resizable-table td {
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .resize-handle {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 8px;
            cursor: col-resize;
            background: linear-gradient(90deg, transparent 0%, transparent 40%, rgba(156, 163, 175, 0.3) 50%, transparent 60%, transparent 100%);
            z-index: 10;
            transition: background 0.15s ease;
        }
        .resize-handle:hover,
        .resize-handle.resizing {
            background: rgba(59, 130, 246, 0.6);
        }
        /* Prevent text selection while resizing */
        .resizing-active {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
    </style>

    
</head>
<body class="bg-blackbook-50 dark:bg-blackbook-900 text-blackbook-900 dark:text-blackbook-100 min-h-screen flex flex-col transition-colors duration-200">
    <!-- Navigation -->
    <nav class="bg-blackbook-800 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-xl font-bold">
                        Perun's BlackBook
                    </a>
                </div>
                <!-- Desktop Navigation -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        
                        <a href="/" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blackbook-700">
                            Dashboard
                        </a>
                        <a href="/people" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blackbook-700">
                            People
                        </a>
                        <a href="/organizations" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blackbook-700">
                            Organizations
                        </a>
                        <a href="/interactions" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blackbook-700">
                            Interactions
                        </a>
                        <a href="/views" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blackbook-700">
                            Views
                        </a>
                        <a href="/graph" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blackbook-700">
                            Graph
                        </a>
                        <a href="/ai-chat" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blackbook-700 relative">
                            <span class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611l-2.025.338a7.022 7.022 0 01-2.722-.014l-.014-.003a7.022 7.022 0 00-2.722.014l-2.025.338c-1.717.293-2.299-2.379-1.067-3.61L5 14.5" />
                                </svg>
                                AI Chat
                                <span id="nav-pending-badge" class="hidden absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full h-5 min-w-[20px] flex items-center justify-center px-1"></span>
                            </span>
                        </a>
                        <a href="/settings" class="px-3 py-2 rounded-md text-sm font-medium bg-blackbook-900 text-white">
                            Settings
                        </a>
                    </div>
                </div>
                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button type="button" onclick="toggleMobileMenu()" class="inline-flex items-center justify-center p-2 rounded-md text-blackbook-400 hover:text-white hover:bg-blackbook-700 focus:outline-none">
                        <span class="sr-only">Open main menu</span>
                        <svg class="h-6 w-6" id="menu-icon-closed" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <svg class="h-6 w-6 hidden" id="menu-icon-open" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Navigation Menu -->
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                
                <a href="/" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blackbook-700">
                    Dashboard
                </a>
                <a href="/people" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blackbook-700">
                    People
                </a>
                <a href="/organizations" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blackbook-700">
                    Organizations
                </a>
                <a href="/interactions" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blackbook-700">
                    Interactions
                </a>
                <a href="/views" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blackbook-700">
                    Views
                </a>
                <a href="/graph" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blackbook-700">
                    Graph
                </a>
                <a href="/ai-chat" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blackbook-700">
                    <span class="flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611l-2.025.338a7.022 7.022 0 01-2.722-.014l-.014-.003a7.022 7.022 0 00-2.722.014l-2.025.338c-1.717.293-2.299-2.379-1.067-3.61L5 14.5" />
                        </svg>
                        AI Chat
                        <span id="nav-pending-badge-mobile" class="hidden bg-orange-500 text-white text-xs rounded-full h-5 min-w-[20px] flex items-center justify-center px-1"></span>
                    </span>
                </a>
                <a href="/settings" class="block px-3 py-2 rounded-md text-base font-medium bg-blackbook-900 text-white">
                    Settings
                </a>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    
<nav class="bg-white border-b border-blackbook-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <ol class="flex items-center space-x-2 text-sm">
            <li>
                <a href="/" class="text-blackbook-500 hover:text-blackbook-700">Home</a>
            </li>
            <li>
                <svg class="h-4 w-4 text-blackbook-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
            </li>
            <li class="text-blackbook-900 font-medium">Settings</li>
        </ol>
    </div>
</nav>


    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 w-full">
        
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-blackbook-900">Settings</h1>
            <p class="text-blackbook-500 mt-1">Manage your Gmail connections and email preferences</p>
        </div>
    </div>

    <!-- Tabs -->
    <div class="border-b border-blackbook-200">
        <nav class="-mb-px flex space-x-8 overflow-x-auto">
            <a href="/settings?tab=syncing"
               class="border-blackbook-600 text-blackbook-900 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Accounts & Syncing
            </a>
            <a href="/settings?tab=email"
               class="border-transparent text-blackbook-500 hover:text-blackbook-700 hover:border-blackbook-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Email Ignore
            </a>
            <a href="/settings?tab=tags"
               class="border-transparent text-blackbook-500 hover:text-blackbook-700 hover:border-blackbook-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Tags
            </a>
            <a href="/settings?tab=data"
               class="border-transparent text-blackbook-500 hover:text-blackbook-700 hover:border-blackbook-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Data Management
            </a>
            <a href="/settings?tab=pending"
               class="border-transparent text-blackbook-500 hover:text-blackbook-700 hover:border-blackbook-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Pending
            </a>
            <a href="/settings?tab=appearance"
               class="border-transparent text-blackbook-500 hover:text-blackbook-700 hover:border-blackbook-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Appearance
            </a>
            <a href="/settings?tab=ai"
               class="border-transparent text-blackbook-500 hover:text-blackbook-700 hover:border-blackbook-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                AI Providers
            </a>
        </nav>
    </div>

    <!-- Tab Content -->
    
    <!-- Accounts & Syncing Tab (Combined) -->
    <div class="space-y-6">
        <!-- Google Accounts Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-lg font-semibold text-blackbook-900">Connected Google Accounts</h2>
                    <p class="text-sm text-blackbook-500 mt-1">
                        Connect your Gmail accounts to search email history and sync contacts
                    </p>
                </div>
                <a href="/auth/google/connect"
                   class="inline-flex items-center px-4 py-2 bg-blackbook-600 text-white font-medium rounded-md hover:bg-blackbook-700 focus:outline-none focus:ring-2 focus:ring-blackbook-500 focus:ring-offset-2">
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Connect Google Account
                </a>
            </div>

            <div id="accounts-list">
                
<div class="space-y-4">
    
    <div class="flex items-center justify-between p-4 border border-blackbook-200 rounded-lg ">
        <div class="flex items-center space-x-4">
            <!-- Google Icon -->
            <div class="w-10 h-10 rounded-full bg-white border border-blackbook-200 flex items-center justify-center">
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
            </div>
            <div>
                <div class="flex items-center gap-2">
                    <span class="font-medium text-blackbook-900">ossowski.chris@gmail.com</span>
                    
                    <span class="px-2 py-0.5 text-xs rounded-full bg-green-100 text-green-700">Active</span>
                    
                </div>
                
                <p class="text-sm text-blackbook-500">Christopher Ossowski</p>
                
                <p class="text-xs text-blackbook-400 mt-1">
                    Connected Dec 08, 2025
                    
                    &bull; Last sync Dec 08, 2025 19:15
                    
                </p>
            </div>
        </div>
        <div class="flex items-center space-x-3">
            <button hx-post="/settings/accounts/4c3a3d79-3db9-4ea3-8c87-f95d2c408e80/toggle"
                    hx-target="#accounts-list"
                    hx-swap="innerHTML"
                    class="text-sm text-blackbook-600 hover:text-blackbook-800 font-medium">
                Disable
            </button>
            <button hx-post="/auth/google/disconnect/4c3a3d79-3db9-4ea3-8c87-f95d2c408e80"
                    hx-target="#accounts-list"
                    hx-swap="innerHTML"
                    hx-confirm="Are you sure you want to disconnect this Google account? This will remove access to email search for this account."
                    class="text-sm text-red-600 hover:text-red-800 font-medium">
                Disconnect
            </button>
        </div>
    </div>
    
</div>

            </div>
        </div>

        <!-- Google Contacts Sync Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-lg font-semibold text-blackbook-900">Google Contacts Sync</h2>
                    <p class="text-sm text-blackbook-500 mt-1">
                        Sync contacts from your connected Google accounts into BlackBook
                    </p>
                </div>
            </div>

            
            <div class="space-y-4 mb-6">
                
                <div class="flex items-center justify-between p-4 bg-blackbook-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blackbook-200 rounded-full flex items-center justify-center text-blackbook-600 mr-3">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-blackbook-900">ossowski.chris@gmail.com</p>
                            <p class="text-sm text-blackbook-500">
                                
                                Last synced: Dec 08, 2025 at 07:15 PM
                                
                            </p>
                        </div>
                    </div>
                    <button hx-post="/import/google/4c3a3d79-3db9-4ea3-8c87-f95d2c408e80"
                            hx-target="#sync-result"
                            hx-swap="innerHTML"
                            hx-indicator="#sync-spinner-4c3a3d79-3db9-4ea3-8c87-f95d2c408e80"
                            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm">
                        <svg id="sync-spinner-4c3a3d79-3db9-4ea3-8c87-f95d2c408e80" class="htmx-indicator animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Sync Contacts
                    </button>
                </div>
                
            </div>

            <div id="sync-result" class="mb-4"></div>

            <div class="flex items-center justify-end">
                <button hx-post="/import/google"
                        hx-target="#sync-result"
                        hx-swap="innerHTML"
                        hx-indicator="#sync-all-spinner"
                        class="inline-flex items-center px-4 py-2 bg-blackbook-600 text-white font-medium rounded-md hover:bg-blackbook-700 focus:outline-none focus:ring-2 focus:ring-blackbook-500 focus:ring-offset-2">
                    <svg id="sync-all-spinner" class="htmx-indicator animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Sync All Accounts
                </button>
            </div>
            
        </div>

        <!-- Google Calendar Settings Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-blackbook-900 flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Google Calendar Settings
                </h2>
                <p class="text-sm text-blackbook-500 mt-1">
                    Configure how calendar events are displayed
                </p>
            </div>

            <!-- Timezone Setting -->
            <div class="space-y-4">
                <div>
                    <label for="calendar-timezone" class="block text-sm font-medium text-blackbook-700 mb-2">
                        Display Timezone
                    </label>
                    <p class="text-xs text-blackbook-500 mb-2">
                        Calendar event times will be converted to this timezone for display
                    </p>
                    <div class="flex items-center gap-4">
                        <select id="calendar-timezone"
                                name="timezone"
                                hx-post="/settings/calendar/timezone"
                                hx-target="#timezone-save-status"
                                hx-swap="innerHTML"
                                hx-trigger="change"
                                class="block w-80 rounded-md border-blackbook-300 shadow-sm focus:border-blackbook-500 focus:ring-blackbook-500 text-sm">
                            <option value="America/New_York" selected>Eastern Time (US & Canada) (America/New_York)</option>
                            <option value="America/Chicago" >Central Time (US & Canada) (America/Chicago)</option>
                            <option value="America/Denver" >Mountain Time (US & Canada) (America/Denver)</option>
                            <option value="America/Los_Angeles" >Pacific Time (US & Canada) (America/Los_Angeles)</option>
                            <option value="America/Anchorage" >Alaska (America/Anchorage)</option>
                            <option value="Pacific/Honolulu" >Hawaii (Pacific/Honolulu)</option>
                            <option value="America/Toronto" >Toronto (America/Toronto)</option>
                            <option value="America/Vancouver" >Vancouver (America/Vancouver)</option>
                            <option value="America/Mexico_City" >Mexico City (America/Mexico_City)</option>
                            <option value="America/Sao_Paulo" >Sao Paulo (America/Sao_Paulo)</option>
                            <option value="America/Buenos_Aires" >Buenos Aires (America/Buenos_Aires)</option>
                            <option value="Europe/London" >London (Europe/London)</option>
                            <option value="Europe/Paris" >Paris (Europe/Paris)</option>
                            <option value="Europe/Berlin" >Berlin (Europe/Berlin)</option>
                            <option value="Europe/Amsterdam" >Amsterdam (Europe/Amsterdam)</option>
                            <option value="Europe/Warsaw" >Warsaw (Europe/Warsaw)</option>
                            <option value="Europe/Moscow" >Moscow (Europe/Moscow)</option>
                            <option value="Europe/Istanbul" >Istanbul (Europe/Istanbul)</option>
                            <option value="Asia/Dubai" >Dubai (Asia/Dubai)</option>
                            <option value="Asia/Kolkata" >India (Asia/Kolkata)</option>
                            <option value="Asia/Singapore" >Singapore (Asia/Singapore)</option>
                            <option value="Asia/Hong_Kong" >Hong Kong (Asia/Hong_Kong)</option>
                            <option value="Asia/Shanghai" >Shanghai (Asia/Shanghai)</option>
                            <option value="Asia/Tokyo" >Tokyo (Asia/Tokyo)</option>
                            <option value="Asia/Seoul" >Seoul (Asia/Seoul)</option>
                            <option value="Australia/Sydney" >Sydney (Australia/Sydney)</option>
                            <option value="Australia/Melbourne" >Melbourne (Australia/Melbourne)</option>
                            <option value="Pacific/Auckland" >Auckland (Pacific/Auckland)</option>
                            <option value="UTC" >UTC</option>
                        </select>
                        <span id="timezone-save-status" class="text-sm"></span>
                    </div>
                </div>
            </div>

            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                <div class="flex">
                    <svg class="h-5 w-5 text-blue-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <p class="text-sm text-blue-700">
                        This setting affects how calendar event times are displayed on the Dashboard and in calendar views.
                        Events are stored in UTC and converted to your selected timezone for display.
                    </p>
                </div>
            </div>
        </div>

        <!-- LinkedIn Import Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-blackbook-900">LinkedIn Import</h2>
                <p class="text-sm text-blackbook-500 mt-1">
                    Import contacts from your LinkedIn connections export
                </p>
            </div>

            <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                <h3 class="text-sm font-medium text-blue-800 mb-2">How to export LinkedIn connections:</h3>
                <ol class="text-sm text-blue-700 list-decimal list-inside space-y-1">
                    <li>Go to LinkedIn &gt; Settings &gt; Data Privacy &gt; Get a copy of your data</li>
                    <li>Select "Connections" and request the archive</li>
                    <li>Download the ZIP file and extract <code class="bg-blue-100 px-1 rounded">Connections.csv</code></li>
                    <li>Upload the CSV file below</li>
                </ol>
            </div>

            <form hx-post="/import/linkedin"
                  hx-target="#linkedin-result"
                  hx-swap="innerHTML"
                  hx-encoding="multipart/form-data"
                  hx-indicator="#linkedin-spinner"
                  hx-on::after-request="htmx.trigger('#import-history', 'reload')"
                  class="space-y-4">
                <div>
                    <label for="linkedin-file" class="block text-sm font-medium text-blackbook-700 mb-1">
                        Select Connections.csv file
                    </label>
                    <input type="file"
                           id="linkedin-file"
                           name="file"
                           accept=".csv"
                           required
                           class="block w-full text-sm text-blackbook-500
                                  file:mr-4 file:py-2 file:px-4
                                  file:rounded-md file:border-0
                                  file:text-sm file:font-medium
                                  file:bg-blackbook-100 file:text-blackbook-700
                                  hover:file:bg-blackbook-200">
                </div>
                <button type="submit"
                        class="inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    <svg id="linkedin-spinner" class="htmx-indicator animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Import LinkedIn Contacts
                </button>
            </form>

            <div id="linkedin-result" class="mt-4"></div>

            <!-- Import History Section -->
            <div class="mt-6 pt-6 border-t border-blackbook-200">
                <h3 class="text-sm font-medium text-blackbook-700 mb-3">Import History</h3>
                <div id="import-history"
                     hx-get="/import/history"
                     hx-trigger="load, reload from:body"
                     hx-swap="innerHTML">
                    <div class="text-center py-4 text-blackbook-400">
                        <svg class="animate-spin mx-auto h-6 w-6" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
</div>

<script>
function filterPendingByStatus(status) {
    window.location.href = '/settings?tab=pending' + (status ? '&pending_status=' + status : '');
}
</script>

    </main>

    <!-- Footer -->
    <footer class="bg-blackbook-800 text-white mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <p class="text-center text-sm text-blackbook-400">
                Perun's BlackBook &copy; 2025 | Personal CRM
            </p>
        </div>
    </footer>

    <!-- Load stats on page load -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Load main stats
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                const personsEl = document.getElementById('stat-persons');
                const orgsEl = document.getElementById('stat-organizations');
                const tagsEl = document.getElementById('stat-tags');
                const interactionsEl = document.getElementById('stat-interactions');

                if (personsEl) personsEl.textContent = stats.persons || 0;
                if (orgsEl) orgsEl.textContent = stats.organizations || 0;
                if (tagsEl) tagsEl.textContent = stats.tags || 0;
                if (interactionsEl) interactionsEl.textContent = stats.interactions || 0;
            } catch (error) {
                console.error('Failed to load stats:', error);
            }

            // Load pending suggestions count for nav badge
            try {
                const response = await fetch('/ai-chat/suggestions/pending-count');
                const data = await response.json();
                updatePendingBadge(data.pending);
            } catch (error) {
                console.error('Failed to load pending suggestions count:', error);
            }
        });

        // Update pending suggestions badge in navigation
        function updatePendingBadge(count) {
            const badge = document.getElementById('nav-pending-badge');
            const badgeMobile = document.getElementById('nav-pending-badge-mobile');

            [badge, badgeMobile].forEach(el => {
                if (el) {
                    if (count > 0) {
                        el.textContent = count > 99 ? '99+' : count;
                        el.classList.remove('hidden');
                    } else {
                        el.classList.add('hidden');
                    }
                }
            });
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const iconClosed = document.getElementById('menu-icon-closed');
            const iconOpen = document.getElementById('menu-icon-open');

            menu.classList.toggle('hidden');
            iconClosed.classList.toggle('hidden');
            iconOpen.classList.toggle('hidden');
        }

        // Column resizing functionality
        function initResizableTable(tableId, storageKey) {
            const table = document.getElementById(tableId);
            if (!table) return;

            const headers = table.querySelectorAll('thead th');

            // Load saved widths
            const savedWidths = localStorage.getItem(storageKey);
            if (savedWidths) {
                try {
                    const widths = JSON.parse(savedWidths);
                    headers.forEach((th, index) => {
                        if (widths[index]) {
                            th.style.width = widths[index] + 'px';
                        }
                    });
                } catch (e) {
                    console.error('Failed to load column widths:', e);
                }
            }

            // Add resize handles to each header
            headers.forEach((th, index) => {
                // Skip last column (no need to resize from the right edge)
                if (index === headers.length - 1) return;

                const handle = document.createElement('div');
                handle.className = 'resize-handle';
                th.appendChild(handle);

                let startX, startWidth, nextStartWidth;
                const nextTh = headers[index + 1];

                handle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    startX = e.pageX;
                    startWidth = th.offsetWidth;
                    nextStartWidth = nextTh ? nextTh.offsetWidth : 0;

                    handle.classList.add('resizing');
                    document.body.classList.add('resizing-active');

                    function onMouseMove(e) {
                        const diff = e.pageX - startX;
                        const newWidth = Math.max(50, startWidth + diff);
                        th.style.width = newWidth + 'px';

                        // Adjust next column if needed
                        if (nextTh && nextStartWidth - diff > 50) {
                            nextTh.style.width = (nextStartWidth - diff) + 'px';
                        }
                    }

                    function onMouseUp() {
                        handle.classList.remove('resizing');
                        document.body.classList.remove('resizing-active');
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);

                        // Save widths to localStorage
                        const widths = [];
                        headers.forEach(h => widths.push(h.offsetWidth));
                        localStorage.setItem(storageKey, JSON.stringify(widths));
                    }

                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                });
            });
        }

        // Re-initialize resizable tables after HTMX swaps
        document.body.addEventListener('htmx:afterSwap', function(evt) {
            // Check if the swapped content contains a resizable table
            const personTable = document.getElementById('person-table');
            const orgTable = document.getElementById('org-table');

            if (personTable) initResizableTable('person-table', 'person-table-widths');
            if (orgTable) initResizableTable('org-table', 'org-table-widths');
        });
    </script>

    
</body>
</html>